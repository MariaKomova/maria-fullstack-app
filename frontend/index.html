<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps App - Frontend (–§–∏–Ω–∞–ª—å–Ω—ã–π –¢–µ—Å—Ç)</title>
    <script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.tailwindcss.com"></script>
    <!-- –î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —à—Ä–∏—Ñ—Ç Inter, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å UI –∫—Ä–∞—Å–∏–≤–µ–µ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* –î–æ–±–∞–≤–ª—è–µ–º Inter Font –∏ –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body { font-family: 'Inter', sans-serif; }
        .input-field { 
            /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
            /* @apply - —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Tailwind –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –≤ CSS */
            display: block; width: 100%; padding: 0.5rem 0.75rem; 
            border: 1px solid #d1d5db; border-radius: 0.375rem; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤ —Å–ø–∏—Å–∫–µ */
        .item-row input[type="text"], .item-row input[type="number"] {
            @apply px-2 py-1 border border-gray-300 rounded-md shadow-inner text-sm flex-grow;
        }
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è CRUD –∫–Ω–æ–ø–æ–∫ */
        .btn-crud {
            @apply px-3 py-1 text-sm font-semibold rounded-lg transition duration-150 ease-in-out shadow-md;
        }
        .btn-update {
            @apply bg-green-500 hover:bg-green-600 text-white;
        }
        .btn-delete {
            @apply bg-red-500 hover:bg-red-600 text-white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start py-8">
    <div id="status-message" class="fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-lg shadow-xl hidden transition-opacity duration-300"></div>


    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-xl mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4 text-center">–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç! üéâ</h1>
        
        <!-- –°–¢–ê–¢–£–° –ë–≠–ö–ï–ù–î–ê -->
        <div id="backend-status" class="mt-4 p-3 rounded-lg font-mono text-sm text-center">
            –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±—ç–∫–µ–Ω–¥–∞...
        </div>
    </div>

    <!-- –§–û–†–ú–ê –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ù–û–í–´–• –≠–õ–ï–ú–ï–ù–¢–û–í -->
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-xl mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç (POST)</h2>
        <form id="create-form" class="space-y-4">
            <div>
                <label for="item-name" class="block text-sm font-medium text-gray-700">–ò–º—è:</label>
                <input type="text" id="item-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
            </div>
            <div>
                <label for="item-value" class="block text-sm font-medium text-gray-700">–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                <input type="number" id="item-value" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 border">
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
            </button>
        </form>
        <p id="create-message" class="mt-4 text-sm"></p>
    </div>

    <!-- –°–ü–ò–°–û–ö –≠–õ–ï–ú–ï–ù–¢–û–í –ò –ö–ù–û–ü–ö–ê –ó–ê–ì–†–£–ó–ö–ò -->
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-xl">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">–î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (GET /api/items)</h2>
        <button id="load-items-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 mb-4">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        </button>
        <div id="items-list" class="space-y-2">
            <p class="text-gray-500">–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–∏ —Å –ë–î.</p>
        </div>
    </div>

    <script>
  // –ë–ê–ó–û–í–´–ô –ü–£–¢–¨ –î–õ–Ø API
        const API_BASE_URL = '/api/items';
        const HEALTH_URL = '/api/health';

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ alert/confirm) ---
        function showStatus(message, isSuccess = true) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden', 'bg-red-600', 'bg-green-600');
            statusDiv.classList.add(isSuccess ? 'bg-green-600' : 'bg-red-600');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 4000);
        }

        // --- –§–£–ù–ö–¶–ò–ò –°–¢–ê–¢–£–°–ê ---
        async function checkBackendStatus() {
            const statusDiv = document.getElementById('backend-status');
            try {
                const response = await fetch(HEALTH_URL);
                const data = await response.json();

                if (response.ok && data.status === 'ok') {
                    statusDiv.className = 'mt-4 p-3 rounded-lg font-mono text-sm bg-green-100 text-green-700';
                    statusDiv.textContent = `‚úÖ –ë—ç–∫–µ–Ω–¥ (API) –¥–æ—Å—Ç—É–ø–µ–Ω! –°—Ç–∞—Ç—É—Å –ë–î: ${data.db_status.toUpperCase()}`;
                    loadItems(); 
                } else {
                    statusDiv.className = 'mt-4 p-3 rounded-lg font-mono text-sm bg-yellow-100 text-yellow-700';
                    statusDiv.textContent = `‚ö†Ô∏è –ë—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –°—Ç–∞—Ç—É—Å: ${data.db_status.toUpperCase()}`;
                }
            } catch (error) {
                statusDiv.className = 'mt-4 p-3 rounded-lg font-mono text-sm bg-red-100 text-red-700';
                statusDiv.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±—ç–∫–µ–Ω–¥—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Flask.';
            }
        }

        // --- –§–£–ù–ö–¶–ò–ò CRUD ---
        
        // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∞–º–∏
        function renderItems(items) {
            const listDiv = document.getElementById('items-list');
            listDiv.innerHTML = '';

            if (items.length === 0) {
                listDiv.innerHTML = '<p class="text-gray-500">–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤.</p>';
                return;
            }

            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.id = `item-${item.id}`; // –î–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                // –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏
                itemElement.className = 'item-row flex flex-col md:flex-row gap-2 items-center p-3 bg-gray-50 border border-gray-200 rounded-lg shadow-sm';
                itemElement.innerHTML = `
                    <span class="font-mono text-xs text-gray-500 w-10">ID: ${item.id}</span>
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ –ò–º—è -->
                    <input type="text" id="name-${item.id}" value="${item.name}" required class="item-row input-field w-full md:w-auto">
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ –ó–Ω–∞—á–µ–Ω–∏–µ -->
                    <input type="number" id="value-${item.id}" value="${item.value}" required class="item-row input-field w-full md:w-auto">
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –û–±–Ω–æ–≤–∏—Ç—å –∏ –£–¥–∞–ª–∏—Ç—å -->
                    <div class="flex space-x-2 w-full md:w-auto md:ml-auto">
                        <button onclick="updateItem(${item.id})" class="btn-crud btn-update w-1/2 md:w-auto">–û–±–Ω–æ–≤–∏—Ç—å</button>
                        <button onclick="deleteItem(${item.id})" class="btn-crud btn-delete w-1/2 md:w-auto">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                listDiv.appendChild(itemElement);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Read)
        async function loadItems() {
            const listDiv = document.getElementById('items-list');
            listDiv.innerHTML = '<p class="text-blue-500">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';

            try {
                const response = await fetch(API_BASE_URL);

                if (response.ok) {
                    const items = await response.json();
                    renderItems(items);
                } else {
                    listDiv.innerHTML = `<p class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${response.statusText}</p>`;
                }
            } catch (error) {
                listDiv.innerHTML = `<p class="text-red-500">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: ${error.message}</p>`;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (Create)
        async function createItem(event) {
            event.preventDefault();
            const nameInput = document.getElementById('item-name');
            const valueInput = document.getElementById('item-value');
            const messageDiv = document.getElementById('create-message');

            const item = {
                name: nameInput.value,
                value: parseInt(valueInput.value)
            };
            
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(item)
                });

                if (response.status === 201) {
                    showStatus(`–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: ${item.name}`, true);
                    messageDiv.textContent = `–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: ${item.name}`;
                    messageDiv.className = 'text-green-600';
                    
                    nameInput.value = '';
                    valueInput.value = '';
                    loadItems(); 
                } else {
                    const errorData = await response.json();
                    showStatus(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${errorData.error || response.statusText}`, false);
                    messageDiv.textContent = `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${errorData.error || response.statusText}`;
                    messageDiv.className = 'text-red-600';
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞.', false);
                messageDiv.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞.';
                messageDiv.className = 'text-red-600';
            }
        }

        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ (Update/PUT) ---
        async function updateItem(id) {
            // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            const name = document.getElementById(`name-${id}`).value.trim();
            const value = parseInt(document.getElementById(`value-${id}`).value);

            if (!name || isNaN(value)) {
                showStatus('–ò–º—è –∏ –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ –∏–ª–∏ –Ω–µ—á–∏—Å–ª–æ–≤—ã–º–∏.', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, value: value })
                });

                if (response.ok) {
                    showStatus(`–≠–ª–µ–º–µ–Ω—Ç ID ${id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!`, true);
                    loadItems(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
                } else {
                    const errorData = await response.json();
                    showStatus(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${errorData.error || response.statusText}`, false);
                }
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ${error.message}`, false);
            }
        }
        
        // --- –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ (Delete/DELETE) ---
        async function deleteItem(id) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.confirm() –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–æ–¥–∞–ª
            if (!window.confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç ID ${id}?`)) {
                 return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${id}`, {
                    method: 'DELETE'
                });

                // DELETE –æ–±—ã—á–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 204 No Content
                if (response.status === 204 || response.ok) {
                    showStatus(`–≠–ª–µ–º–µ–Ω—Ç ID ${id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`, true);
                    loadItems(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    const errorData = await response.json();
                    showStatus(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${errorData.error || response.statusText}`, false);
                }
            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`, false);
            }
        }


        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        document.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫ —Ñ–æ—Ä–º–∞–º –∏ –∫–Ω–æ–ø–∫–∞–º
            document.getElementById('create-form').addEventListener('submit', createItem);
            document.getElementById('load-items-btn').addEventListener('click', loadItems);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ä–∞–∑—É –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            checkBackendStatus();
            setInterval(checkBackendStatus, 10000);
        });
    </script>
</body>
</html>
